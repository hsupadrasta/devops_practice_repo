import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import java.io.FileOutputStream;
import java.sql.*;

public class DatabaseExcelExporter {
    private String url;
    private String user;
    private String password;
    private String query;
    private String excelFilePath;

    public DatabaseExcelExporter(String url, String user, String password, String query, String excelFilePath) {
        this.url = url;
        this.user = user;
        this.password = password;
        this.query = query;
        this.excelFilePath = excelFilePath;
    }

    public void export() {
        try (Connection conn = DriverManager.getConnection(url, user, password);
             Statement stmt = conn.createStatement();
             ResultSet rs = stmt.executeQuery(query)) {

            Workbook workbook = new XSSFWorkbook();
            Sheet sheet = workbook.createSheet("Results");

            ResultSetMetaData metaData = rs.getMetaData();
            int columnCount = metaData.getColumnCount();

            createHeaderRow(sheet, metaData, columnCount);
            writeDataRows(rs, workbook, sheet, columnCount);

            try (FileOutputStream outputStream = new FileOutputStream(excelFilePath)) {
                workbook.write(outputStream);
            }
            workbook.close();

            System.out.println("Data exported to Excel file successfully!");
        } catch (SQLException e) {
            System.err.println("Database connection error: " + e.getMessage());
        } catch (Exception e) {
            System.err.println("Excel file error: " + e.getMessage());
        }
    }

    private void createHeaderRow(Sheet sheet, ResultSetMetaData metaData, int columnCount) throws SQLException {
        Row headerRow = sheet.createRow(0);
        for (int col = 1; col <= columnCount; col++) {
            Cell cell = headerRow.createCell(col - 1);
            cell.setCellValue(metaData.getColumnName(col));
        }
    }

    private void writeDataRows(ResultSet rs, Workbook workbook, Sheet sheet, int columnCount) throws SQLException {
        int rowIndex = 1;
        while (rs.next()) {
            Row row = sheet.createRow(rowIndex++);

            for (int col = 1; col <= columnCount; col++) {
                Cell cell = row.createCell(col - 1);
                cell.setCellValue(rs.getString(col)); // For simplicity, getting all as String
                // Can be enhanced to handle different data types
            }
        }
    }
}

public class DatabaseToExcelApp {
    public static void main(String[] args) {
        String url = "jdbc:oracle:thin:@your_oracle_db_url:1521:your_db_name";
        String user = "your_username";
        String password = "your_password";
        String query = "SELECT * FROM your_table"; // Replace with your actual query
        String excelFilePath = "results.xlsx";

        DatabaseExcelExporter exporter = new DatabaseExcelExporter(url, user, password, query, excelFilePath);
        exporter.export();
    }
}
