import sqlite3
import pytest

@pytest.fixture(scope="function")
def db_connection():
    connection = sqlite3.connect(":memory:")  # Use an in-memory SQLite database
    yield connection
    connection.close()

def create_table(connection):
    cursor = connection.cursor()
    cursor.execute("""
        CREATE TABLE users (
            id INTEGER PRIMARY KEY,
            username TEXT,
            email TEXT
        )
    """)
    connection.commit()

def insert_data(connection):
    cursor = connection.cursor()
    cursor.executemany("""
        INSERT INTO users (username, email)
        VALUES (?, ?)
    """, [("alice", "alice@example.com"), ("bob", "bob@example.com")])
    connection.commit()

def test_database_query(db_connection):
    create_table(db_connection)
    insert_data(db_connection)

    cursor = db_connection.cursor()
    cursor.execute("SELECT username, email FROM users")
    data = cursor.fetchall()

    assert len(data) == 2
    assert ("alice", "alice@example.com") in data
    assert ("bob", "bob@example.com") in data

if __name__ == "__main__":
    pytest.main(["-v", "test_database.py"])
